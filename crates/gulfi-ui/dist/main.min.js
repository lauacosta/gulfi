var initKeyboard=(()=>{document.addEventListener(`keydown`,a=>{const b=document.getElementById(`search-input`);a.ctrlKey&&a.key===`b`&&(a.preventDefault(),b.focus())},!1);window.addEventListener(`keydown`,a=>{if(a.ctrlKey&&a.shiftKey&&a.key.toLowerCase()===`s`)return a.preventDefault(),a.stopImmediatePropagation(),descargarCSVGlobal(),!1},{capture:!0,passive:!1})});var descargarCSVFavoritos=((a,b)=>{if(!a)return undefined;try{const c=JSON.parse(a);if(!c||c.length===0)return undefined;const d=[];for(const a of c)d.push(`"${a.replace(/"/g,`""`)}"`);const e=d.join(`
`);const f=new Blob([e],{type:`text/csv`});const g=document.createElement(`a`);g.href=URL.createObjectURL(f);g.download=`${b}.csv`;g.click();URL.revokeObjectURL(g.href)}catch(b){console.error(b);console.log(a)}});var initPagination=(()=>{var i=((a,b)=>{const c=document.querySelector(`.page-info`);c.textContent=`PÃ¡gina ${a+ 1} de ${b}`});var g=(a=>{const c=a*b;const f=c+ b;d.forEach((a,b)=>{a.style.display=b>=c&&b<f?``:`none`});i(a,e)});var h=((a,b,d)=>{const f=document.createElement(`button`);f.textContent=`<<`;f.addEventListener(`click`,a=>{a.preventDefault();c=0;d(c)});const g=document.createElement(`button`);g.textContent=`<`;g.addEventListener(`click`,a=>{a.preventDefault();c>0&&d(--c)});const h=document.createElement(`span`);h.classList.add(`page-info`);const j=document.createElement(`button`);j.textContent=`>`;j.addEventListener(`click`,a=>{a.preventDefault();c<e- 1&&d(++c)});const k=document.createElement(`button`);k.textContent=`>>`;k.addEventListener(`click`,a=>{a.preventDefault();c=e- 1;d(c)});a.append(f,g,h,j,k);i(c,b)});const a=document.querySelector(`.modern-table`);if(!a)return undefined;const b=10;let c=0;const d=Array.from(a.getElementsByTagName(`tr`)).slice(1);const e=Math.ceil(d.length/b);const f=document.querySelector(`.pagination`);h(f,e,g);g(c)});var initHistorial=(()=>{const a=document.querySelectorAll(`.list-item`);const b=document.getElementById(`search-input`);for(const c of a)c.addEventListener(`click`,a=>{a.preventDefault();const d=c.textContent||``;b.value=d.trim()})});var calcularPeso=(a=>{const b=JSON.stringify(a);const c=new Blob([b]).size;return (c/1024).toFixed(2)});var descargarCSVGlobal=(()=>{if(heldData.length===0)return undefined;const a=[];a.push(heldData.join(`,`));const b=a.join(`
`);const c=new Blob([b],{type:`text/csv`});const d=URL.createObjectURL(c);const e=document.createElement(`a`);e.href=d;e.download=`busqueda.csv`;e.click();URL.revokeObjectURL(d);heldData=[];heldHeaders=[];heldSearches=[];itemsCount.textContent=0;dataWeight.textContent=`0 KB`});var updateHistorial=(async()=>{const a=document.getElementById(`historial`);if(!a)return undefined;try{const b=await fetch(`/historial`);if(!b.ok)return a.innerHTML=`<li>Ha ocurrido un error.</li>`,undefined;const c=await b.json();a.innerHTML=``;if(c.length===0)return a.innerHTML=`<li>No se encuentran elementos.</li>`,undefined;for(const b of c){const c=document.createElement(`li`);c.textContent=b.query;c.classList.add(`list-item`);const d=document.createElement(`button`);d.innerHTML=`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="24" height="24">
                    <path d="M170.5 51.6L151.5 80l145 0-19-28.4c-1.5-2.2-4-3.6-6.7-3.6l-93.7 0c-2.7 0-5.2 1.3-6.7 3.6zm147-26.6L354.2 80 368 80l48 0 8 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-8 0 0 304c0 44.2-35.8 80-80 80l-224 0c-44.2 0-80-35.8-80-80l0-304-8 0c-13.3 0-24-10.7-24-24S10.7 80 24 80l8 0 48 0 13.8 0 36.7-55.1C140.9 9.4 158.4 0 177.1 0l93.7 0c18.7 0 36.2 9.4 46.6 24.9zM80 128l0 304c0 17.7 14.3 32 32 32l224 0c17.7 0 32-14.3 32-32l0-304L80 128zm80 64l0 208c0 8.8-7.2 16-16 16s-16-7.2-16-16l0-208c0-8.8 7.2-16 16-16s16 7.2 16 16zm80 0l0 208c0 8.8-7.2 16-16 16s-16-7.2-16-16l0-208c0-8.8 7.2-16 16-16s16 7.2 16 16zm80 0l0 208c0 8.8-7.2 16-16 16s-16-7.2-16-16l0-208c0-8.8 7.2-16 16-16s16 7.2 16 16z"/>
                </svg>
            `;d.classList.add(`delete-btn`);d.addEventListener(`click`,async(a)=>{a.preventDefault();try{const a=await fetch(`/historial?query=${encodeURIComponent(b.query)}`,{method:`DELETE`});if(a.ok)c.remove();else throw Error(`Error al eliminar el elemento.`)}catch(a){console.error(`Ha ocurrido un error al intentar eliminar el elemento.`)}});c.appendChild(d);a.appendChild(c)}}catch(b){a.innerHTML=`<li>Ha ocurrido un error.</li>`}});var hideElements=(()=>{const a=document.querySelectorAll(`.ocultable`);const b=document.getElementById(`strategy`);const c=document.querySelector(`.balance-slider`);if(!a||!b||!c)return undefined;if(b.value===`ReciprocalRankFusion`){c.style.display=`block`;for(const b of a)b.style.display=`block`}else{c.style.display=`none`;if(b.value===`Fts`)for(const b of a)b.style.display=`none`;else for(const b of a)b.style.display=`block`};b.addEventListener(`change`,()=>{if(b.value===`ReciprocalRankFusion`){c.style.display=`block`;for(const b of a)b.style.display=`block`}else{c.style.display=`none`;if(b.value===`Fts`)for(const b of a)b.style.display=`none`;else for(const b of a)b.style.display=`block`}})});var listenerResetHeldData=(()=>{const a=document.getElementById(`resetDownloadBtn`);a&&a.addEventListener(`click`,a=>{a.preventDefault();heldData=[];const b=calcularPeso(heldData);itemsCount.textContent=heldData.length;dataWeight.textContent=`${b} KB`;downloadBtn.disabled=!0})});var setSaveButton=(()=>{const a=document.getElementById(`saveBtn`);if(!a)return undefined;a.addEventListener(`click`,async(a)=>{a.preventDefault();if(heldData.length===0||heldSearches.length===0)return undefined;const b=prompt(`Ingresa un nombre para guardarlo`);const c=b?.replace(/[^a-zA-Z_\-\s]/g,``)||`ERROR`;if(c!==null&&c!==``){const a={nombre:c,data:JSON.stringify(heldData),busquedas:JSON.stringify(heldSearches)};try{const b=await fetch(`/favoritos`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify(a)});if(b.ok)heldSearches=[];else throw Error(`Error al guardar`)}catch(a){console.error(`Error:`,a)}}})});var initSlider=(()=>{const a=document.getElementById(`balanceSlider`);const b=document.getElementById(`value1Display`);const c=document.getElementById(`value2Display`);const d=document.getElementById(`hiddenValue1`);const e=document.getElementById(`hiddenValue2`);if(!a||!b||!c||!e||!d)return undefined;const f=()=>{const f=a.value;const g=100- f;b.textContent=f;c.textContent=g;d.value=f;e.value=g};a.addEventListener(`input`,f)});var guardarResultados=(()=>{const a=document.getElementById(`table-content`);const b=document.getElementById(`itemsCount`);const c=document.getElementById(`dataWeight`);const d=document.getElementById(`downloadBtn`);const e=a.querySelectorAll(`thead th`);e.forEach((e,f)=>{e.addEventListener(`mousedown`,()=>{if(!isHolding){isHolding=!0;heldHeaders.push(e.innerText);heldData.push(...[...a.querySelectorAll(`tbody tr`)].map(a=>{const b=a.children[f];return b?b.innerText.trim().replace(/\n/g,``):``}));const g=calcularPeso(heldData);b.textContent=heldData.length;c.textContent=`${g} KB`;d.disabled=!1;const h=document.getElementById(`search-input`);h!==null&&h.value.trim()&&heldSearches.push(h.value)}});e.addEventListener(`mouseup`,()=>{isHolding=!1})});d&&d.addEventListener(`click`,async(a)=>{a.preventDefault();descargarCSVGlobal()})});let heldData=[];let heldHeaders=[];let heldSearches=[];let isHolding=!1;document.addEventListener(`DOMContentLoaded`,async()=>{await updateHistorial();initHistorial();initKeyboard();hideElements();initSlider();setSaveButton();listenerResetHeldData();document.body.addEventListener(`htmx:afterRequest`,async()=>{await updateHistorial();initHistorial();guardarResultados();initPagination()})})